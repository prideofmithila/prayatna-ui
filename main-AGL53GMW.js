import{$ as ce,A as vt,Ba as jt,C as R,E as kt,Ea as Mt,F as X,Fa as Vt,G as ee,Ga as $t,H as wt,Ha as Te,I as yt,Ia as Bt,Ja as Q,K as Tt,Ka as se,La as qt,M as St,Ma as Kt,N as Ct,O as Et,Oa as zt,Qa as Wt,R as It,Ra as Qt,S as ae,T as At,U as j,W as Fe,X as ye,Y as xt,a as oe,ba as Lt,c as V,ca as W,d as ds,da as L,e as He,ea as D,f as ht,fa as K,g as $,ga as Pt,h as be,ha as Nt,i as ut,ia as le,j as ve,ja as te,k as dt,ka as he,l as ft,la as Dt,ma as ue,n as mt,na as de,o as F,oa as Ot,p as pt,pa as Ut,q as G,qa as B,r as gt,ra as fe,s as _t,t as ke,u as we,v as bt,w as Re,xa as Ht,ya as Rt,z as J,za as Ft}from"./chunk-XL53VMAI.js";var is=V(($e,Be)=>{"use strict";(function(s,r){typeof $e=="object"&&typeof Be<"u"?Be.exports=r():typeof define=="function"&&define.amd?define(r):(s=typeof globalThis<"u"?globalThis:s||self,s.Data=r())})($e,function(){"use strict";let s=new Map;return{set(e,t,i){s.has(e)||s.set(e,new Map);let n=s.get(e);if(!n.has(t)&&n.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(n.keys())[0]}.`);return}n.set(t,i)},get(e,t){return s.has(e)&&s.get(e).get(t)||null},remove(e,t){if(!s.has(e))return;let i=s.get(e);i.delete(t),i.size===0&&s.delete(e)}}})});var z=V((Pe,ns)=>{"use strict";(function(s,r){typeof Pe=="object"&&typeof ns<"u"?r(Pe):typeof define=="function"&&define.amd?define(["exports"],r):(s=typeof globalThis<"u"?globalThis:s||self,r(s.Index={}))})(Pe,function(s){"use strict";let t="transitionend",i=h=>(h&&window.CSS&&window.CSS.escape&&(h=h.replace(/#([^\s"#']+)/g,(b,m)=>`#${CSS.escape(m)}`)),h),n=h=>h==null?`${h}`:Object.prototype.toString.call(h).match(/\s([a-z]+)/i)[1].toLowerCase(),o=h=>{do h+=Math.floor(Math.random()*1e6);while(document.getElementById(h));return h},a=h=>{if(!h)return 0;let{transitionDuration:b,transitionDelay:m}=window.getComputedStyle(h),C=Number.parseFloat(b),x=Number.parseFloat(m);return!C&&!x?0:(b=b.split(",")[0],m=m.split(",")[0],(Number.parseFloat(b)+Number.parseFloat(m))*1e3)},l=h=>{h.dispatchEvent(new Event(t))},u=h=>!h||typeof h!="object"?!1:(typeof h.jquery<"u"&&(h=h[0]),typeof h.nodeType<"u"),d=h=>u(h)?h.jquery?h[0]:h:typeof h=="string"&&h.length>0?document.querySelector(i(h)):null,c=h=>{if(!u(h)||h.getClientRects().length===0)return!1;let b=getComputedStyle(h).getPropertyValue("visibility")==="visible",m=h.closest("details:not([open])");if(!m)return b;if(m!==h){let C=h.closest("summary");if(C&&C.parentNode!==m||C===null)return!1}return b},_=h=>!h||h.nodeType!==Node.ELEMENT_NODE||h.classList.contains("disabled")?!0:typeof h.disabled<"u"?h.disabled:h.hasAttribute("disabled")&&h.getAttribute("disabled")!=="false",f=h=>{if(!document.documentElement.attachShadow)return null;if(typeof h.getRootNode=="function"){let b=h.getRootNode();return b instanceof ShadowRoot?b:null}return h instanceof ShadowRoot?h:h.parentNode?f(h.parentNode):null},v=()=>{},y=h=>{h.offsetHeight},P=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,E=[],w=h=>{document.readyState==="loading"?(E.length||document.addEventListener("DOMContentLoaded",()=>{for(let b of E)b()}),E.push(h)):h()},M=()=>document.documentElement.dir==="rtl",p=h=>{w(()=>{let b=P();if(b){let m=h.NAME,C=b.fn[m];b.fn[m]=h.jQueryInterface,b.fn[m].Constructor=h,b.fn[m].noConflict=()=>(b.fn[m]=C,h.jQueryInterface)}})},g=(h,b=[],m=h)=>typeof h=="function"?h.call(...b):m,k=(h,b,m=!0)=>{if(!m){g(h);return}let x=a(b)+5,N=!1,I=({target:U})=>{U===b&&(N=!0,b.removeEventListener(t,I),g(h))};b.addEventListener(t,I),setTimeout(()=>{N||l(b)},x)},T=(h,b,m,C)=>{let x=h.length,N=h.indexOf(b);return N===-1?!m&&C?h[x-1]:h[0]:(N+=m?1:-1,C&&(N=(N+x)%x),h[Math.max(0,Math.min(N,x-1))])};s.defineJQueryPlugin=p,s.execute=g,s.executeAfterTransition=k,s.findShadowRoot=f,s.getElement=d,s.getNextActiveElement=T,s.getTransitionDurationFromElement=a,s.getUID=o,s.getjQuery=P,s.isDisabled=_,s.isElement=u,s.isRTL=M,s.isVisible=c,s.noop=v,s.onDOMContentLoaded=w,s.parseSelector=i,s.reflow=y,s.toType=n,s.triggerTransitionEnd=l,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})})});var re=V((qe,Ke)=>{"use strict";(function(s,r){typeof qe=="object"&&typeof Ke<"u"?Ke.exports=r(z()):typeof define=="function"&&define.amd?define(["../util/index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.EventHandler=r(s.Index))})(qe,function(s){"use strict";let r=/[^.]*(?=\..*)\.|.*/,e=/\..*/,t=/::\d+$/,i={},n=1,o={mouseenter:"mouseover",mouseleave:"mouseout"},a=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function l(p,g){return g&&`${g}::${n++}`||p.uidEvent||n++}function u(p){let g=l(p);return p.uidEvent=g,i[g]=i[g]||{},i[g]}function d(p,g){return function k(T){return M(T,{delegateTarget:p}),k.oneOff&&w.off(p,T.type,g),g.apply(p,[T])}}function c(p,g,k){return function T(h){let b=p.querySelectorAll(g);for(let{target:m}=h;m&&m!==this;m=m.parentNode)for(let C of b)if(C===m)return M(h,{delegateTarget:m}),T.oneOff&&w.off(p,h.type,g,k),k.apply(m,[h])}}function _(p,g,k=null){return Object.values(p).find(T=>T.callable===g&&T.delegationSelector===k)}function f(p,g,k){let T=typeof g=="string",h=T?k:g||k,b=E(p);return a.has(b)||(b=p),[T,h,b]}function v(p,g,k,T,h){if(typeof g!="string"||!p)return;let[b,m,C]=f(g,k,T);g in o&&(m=(_e=>function(Z){if(!Z.relatedTarget||Z.relatedTarget!==Z.delegateTarget&&!Z.delegateTarget.contains(Z.relatedTarget))return _e.call(this,Z)})(m));let x=u(p),N=x[C]||(x[C]={}),I=_(N,m,b?k:null);if(I){I.oneOff=I.oneOff&&h;return}let U=l(m,g.replace(r,"")),S=b?c(p,k,m):d(p,m);S.delegationSelector=b?k:null,S.callable=m,S.oneOff=h,S.uidEvent=U,N[U]=S,p.addEventListener(C,S,b)}function y(p,g,k,T,h){let b=_(g[k],T,h);b&&(p.removeEventListener(k,b,!!h),delete g[k][b.uidEvent])}function P(p,g,k,T){let h=g[k]||{};for(let[b,m]of Object.entries(h))b.includes(T)&&y(p,g,k,m.callable,m.delegationSelector)}function E(p){return p=p.replace(e,""),o[p]||p}let w={on(p,g,k,T){v(p,g,k,T,!1)},one(p,g,k,T){v(p,g,k,T,!0)},off(p,g,k,T){if(typeof g!="string"||!p)return;let[h,b,m]=f(g,k,T),C=m!==g,x=u(p),N=x[m]||{},I=g.startsWith(".");if(typeof b<"u"){if(!Object.keys(N).length)return;y(p,x,m,b,h?k:null);return}if(I)for(let U of Object.keys(x))P(p,x,U,g.slice(1));for(let[U,S]of Object.entries(N)){let O=U.replace(t,"");(!C||g.includes(O))&&y(p,x,m,S.callable,S.delegationSelector)}},trigger(p,g,k){if(typeof g!="string"||!p)return null;let T=s.getjQuery(),h=E(g),b=g!==h,m=null,C=!0,x=!0,N=!1;b&&T&&(m=T.Event(g,k),T(p).trigger(m),C=!m.isPropagationStopped(),x=!m.isImmediatePropagationStopped(),N=m.isDefaultPrevented());let I=M(new Event(g,{bubbles:C,cancelable:!0}),k);return N&&I.preventDefault(),x&&p.dispatchEvent(I),I.defaultPrevented&&m&&m.preventDefault(),I}};function M(p,g={}){for(let[k,T]of Object.entries(g))try{p[k]=T}catch{Object.defineProperty(p,k,{configurable:!0,get(){return T}})}return p}return w})});var Qe=V((ze,We)=>{"use strict";(function(s,r){typeof ze=="object"&&typeof We<"u"?We.exports=r():typeof define=="function"&&define.amd?define(r):(s=typeof globalThis<"u"?globalThis:s||self,s.Manipulator=r())})(ze,function(){"use strict";function s(t){if(t==="true")return!0;if(t==="false")return!1;if(t===Number(t).toString())return Number(t);if(t===""||t==="null")return null;if(typeof t!="string")return t;try{return JSON.parse(decodeURIComponent(t))}catch{return t}}function r(t){return t.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`)}return{setDataAttribute(t,i,n){t.setAttribute(`data-bs-${r(i)}`,n)},removeDataAttribute(t,i){t.removeAttribute(`data-bs-${r(i)}`)},getDataAttributes(t){if(!t)return{};let i={},n=Object.keys(t.dataset).filter(o=>o.startsWith("bs")&&!o.startsWith("bsConfig"));for(let o of n){let a=o.replace(/^bs/,"");a=a.charAt(0).toLowerCase()+a.slice(1),i[a]=s(t.dataset[o])}return i},getDataAttribute(t,i){return s(t.getAttribute(`data-bs-${r(i)}`))}}})});var Ne=V((Je,Ye)=>{"use strict";(function(s,r){typeof Je=="object"&&typeof Ye<"u"?Ye.exports=r(Qe(),z()):typeof define=="function"&&define.amd?define(["../dom/manipulator","./index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.Config=r(s.Manipulator,s.Index))})(Je,function(s,r){"use strict";class e{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(i){return i=this._mergeConfigObj(i),i=this._configAfterMerge(i),this._typeCheckConfig(i),i}_configAfterMerge(i){return i}_mergeConfigObj(i,n){let o=r.isElement(n)?s.getDataAttribute(n,"config"):{};return oe(oe(oe(oe({},this.constructor.Default),typeof o=="object"?o:{}),r.isElement(n)?s.getDataAttributes(n):{}),typeof i=="object"?i:{})}_typeCheckConfig(i,n=this.constructor.DefaultType){for(let[o,a]of Object.entries(n)){let l=i[o],u=r.isElement(l)?"element":r.toType(l);if(!new RegExp(a).test(u))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${o}" provided type "${u}" but expected type "${a}".`)}}}return e})});var rs=V((Ze,Ge)=>{"use strict";(function(s,r){typeof Ze=="object"&&typeof Ge<"u"?Ge.exports=r(is(),re(),Ne(),z()):typeof define=="function"&&define.amd?define(["./dom/data","./dom/event-handler","./util/config","./util/index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.BaseComponent=r(s.Data,s.EventHandler,s.Config,s.Index))})(Ze,function(s,r,e,t){"use strict";let i="5.3.8";class n extends e{constructor(a,l){super(),a=t.getElement(a),a&&(this._element=a,this._config=this._getConfig(l),s.set(this._element,this.constructor.DATA_KEY,this))}dispose(){s.remove(this._element,this.constructor.DATA_KEY),r.off(this._element,this.constructor.EVENT_KEY);for(let a of Object.getOwnPropertyNames(this))this[a]=null}_queueCallback(a,l,u=!0){t.executeAfterTransition(a,l,u)}_getConfig(a){return a=this._mergeConfigObj(a,this._element),a=this._configAfterMerge(a),this._typeCheckConfig(a),a}static getInstance(a){return s.get(t.getElement(a),this.DATA_KEY)}static getOrCreateInstance(a,l={}){return this.getInstance(a)||new this(a,typeof l=="object"?l:null)}static get VERSION(){return i}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(a){return`${a}${this.EVENT_KEY}`}}return n})});var ge=V((Xe,et)=>{"use strict";(function(s,r){typeof Xe=="object"&&typeof et<"u"?et.exports=r(z()):typeof define=="function"&&define.amd?define(["../util/index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.SelectorEngine=r(s.Index))})(Xe,function(s){"use strict";let r=t=>{let i=t.getAttribute("data-bs-target");if(!i||i==="#"){let n=t.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),i=n&&n!=="#"?n.trim():null}return i?i.split(",").map(n=>s.parseSelector(n)).join(","):null},e={find(t,i=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(i,t))},findOne(t,i=document.documentElement){return Element.prototype.querySelector.call(i,t)},children(t,i){return[].concat(...t.children).filter(n=>n.matches(i))},parents(t,i){let n=[],o=t.parentNode.closest(i);for(;o;)n.push(o),o=o.parentNode.closest(i);return n},prev(t,i){let n=t.previousElementSibling;for(;n;){if(n.matches(i))return[n];n=n.previousElementSibling}return[]},next(t,i){let n=t.nextElementSibling;for(;n;){if(n.matches(i))return[n];n=n.nextElementSibling}return[]},focusableChildren(t){let i=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(n=>`${n}:not([tabindex^="-"])`).join(",");return this.find(i,t).filter(n=>!s.isDisabled(n)&&s.isVisible(n))},getSelectorFromElement(t){let i=r(t);return i&&e.findOne(i)?i:null},getElementFromSelector(t){let i=r(t);return i?e.findOne(i):null},getMultipleElementsFromSelector(t){let i=r(t);return i?e.find(i):[]}};return e})});var os=V((tt,st)=>{"use strict";(function(s,r){typeof tt=="object"&&typeof st<"u"?st.exports=r(re(),Ne(),z()):typeof define=="function"&&define.amd?define(["../dom/event-handler","./config","./index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.Backdrop=r(s.EventHandler,s.Config,s.Index))})(tt,function(s,r,e){"use strict";let t="backdrop",i="fade",n="show",o=`mousedown.bs.${t}`,a={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},l={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class u extends r{constructor(c){super(),this._config=this._getConfig(c),this._isAppended=!1,this._element=null}static get Default(){return a}static get DefaultType(){return l}static get NAME(){return t}show(c){if(!this._config.isVisible){e.execute(c);return}this._append();let _=this._getElement();this._config.isAnimated&&e.reflow(_),_.classList.add(n),this._emulateAnimation(()=>{e.execute(c)})}hide(c){if(!this._config.isVisible){e.execute(c);return}this._getElement().classList.remove(n),this._emulateAnimation(()=>{this.dispose(),e.execute(c)})}dispose(){this._isAppended&&(s.off(this._element,o),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let c=document.createElement("div");c.className=this._config.className,this._config.isAnimated&&c.classList.add(i),this._element=c}return this._element}_configAfterMerge(c){return c.rootElement=e.getElement(c.rootElement),c}_append(){if(this._isAppended)return;let c=this._getElement();this._config.rootElement.append(c),s.on(c,o,()=>{e.execute(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(c){e.executeAfterTransition(c,this._getElement(),this._config.isAnimated)}}return u})});var cs=V((De,as)=>{"use strict";(function(s,r){typeof De=="object"&&typeof as<"u"?r(De,re(),ge(),z()):typeof define=="function"&&define.amd?define(["exports","../dom/event-handler","../dom/selector-engine","./index"],r):(s=typeof globalThis<"u"?globalThis:s||self,r(s.ComponentFunctions={},s.EventHandler,s.SelectorEngine,s.Index))})(De,function(s,r,e,t){"use strict";let i=(n,o="hide")=>{let a=`click.dismiss${n.EVENT_KEY}`,l=n.NAME;r.on(document,a,`[data-bs-dismiss="${l}"]`,function(u){if(["A","AREA"].includes(this.tagName)&&u.preventDefault(),t.isDisabled(this))return;let d=e.getElementFromSelector(this)||this.closest(`.${l}`);n.getOrCreateInstance(d)[o]()})};s.enableDismissTrigger=i,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})})});var ls=V((it,nt)=>{"use strict";(function(s,r){typeof it=="object"&&typeof nt<"u"?nt.exports=r(re(),ge(),Ne()):typeof define=="function"&&define.amd?define(["../dom/event-handler","../dom/selector-engine","./config"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.Focustrap=r(s.EventHandler,s.SelectorEngine,s.Config))})(it,function(s,r,e){"use strict";let t="focustrap",n=".bs.focustrap",o=`focusin${n}`,a=`keydown.tab${n}`,l="Tab",u="forward",d="backward",c={autofocus:!0,trapElement:null},_={autofocus:"boolean",trapElement:"element"};class f extends e{constructor(y){super(),this._config=this._getConfig(y),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return c}static get DefaultType(){return _}static get NAME(){return t}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),s.off(document,n),s.on(document,o,y=>this._handleFocusin(y)),s.on(document,a,y=>this._handleKeydown(y)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,s.off(document,n))}_handleFocusin(y){let{trapElement:P}=this._config;if(y.target===document||y.target===P||P.contains(y.target))return;let E=r.focusableChildren(P);E.length===0?P.focus():this._lastTabNavDirection===d?E[E.length-1].focus():E[0].focus()}_handleKeydown(y){y.key===l&&(this._lastTabNavDirection=y.shiftKey?d:u)}}return f})});var hs=V((rt,ot)=>{"use strict";(function(s,r){typeof rt=="object"&&typeof ot<"u"?ot.exports=r(Qe(),ge(),z()):typeof define=="function"&&define.amd?define(["../dom/manipulator","../dom/selector-engine","./index"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.Scrollbar=r(s.Manipulator,s.SelectorEngine,s.Index))})(rt,function(s,r,e){"use strict";let t=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",i=".sticky-top",n="padding-right",o="margin-right";class a{constructor(){this._element=document.body}getWidth(){let u=document.documentElement.clientWidth;return Math.abs(window.innerWidth-u)}hide(){let u=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,n,d=>d+u),this._setElementAttributes(t,n,d=>d+u),this._setElementAttributes(i,o,d=>d-u)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,n),this._resetElementAttributes(t,n),this._resetElementAttributes(i,o)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(u,d,c){let _=this.getWidth(),f=v=>{if(v!==this._element&&window.innerWidth>v.clientWidth+_)return;this._saveInitialAttribute(v,d);let y=window.getComputedStyle(v).getPropertyValue(d);v.style.setProperty(d,`${c(Number.parseFloat(y))}px`)};this._applyManipulationCallback(u,f)}_saveInitialAttribute(u,d){let c=u.style.getPropertyValue(d);c&&s.setDataAttribute(u,d,c)}_resetElementAttributes(u,d){let c=_=>{let f=s.getDataAttribute(_,d);if(f===null){_.style.removeProperty(d);return}s.removeDataAttribute(_,d),_.style.setProperty(d,f)};this._applyManipulationCallback(u,c)}_applyManipulationCallback(u,d){if(e.isElement(u)){d(u);return}for(let c of r.find(u,this._element))d(c)}}return a})});var us=V((at,ct)=>{"use strict";(function(s,r){typeof at=="object"&&typeof ct<"u"?ct.exports=r(rs(),re(),ge(),os(),cs(),ls(),z(),hs()):typeof define=="function"&&define.amd?define(["./base-component","./dom/event-handler","./dom/selector-engine","./util/backdrop","./util/component-functions","./util/focustrap","./util/index","./util/scrollbar"],r):(s=typeof globalThis<"u"?globalThis:s||self,s.Offcanvas=r(s.BaseComponent,s.EventHandler,s.SelectorEngine,s.Backdrop,s.ComponentFunctions,s.Focustrap,s.Index,s.Scrollbar))})(at,function(s,r,e,t,i,n,o,a){"use strict";let l="offcanvas",d=".bs.offcanvas",c=".data-api",_=`load${d}${c}`,f="Escape",v="show",y="showing",P="hiding",E="offcanvas-backdrop",w=".offcanvas.show",M=`show${d}`,p=`shown${d}`,g=`hide${d}`,k=`hidePrevented${d}`,T=`hidden${d}`,h=`resize${d}`,b=`click${d}${c}`,m=`keydown.dismiss${d}`,C='[data-bs-toggle="offcanvas"]',x={backdrop:!0,keyboard:!0,scroll:!1},N={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class I extends s{constructor(S,O){super(S,O),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return x}static get DefaultType(){return N}static get NAME(){return l}toggle(S){return this._isShown?this.hide():this.show(S)}show(S){if(this._isShown||r.trigger(this._element,M,{relatedTarget:S}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new a().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(y);let _e=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(v),this._element.classList.remove(y),r.trigger(this._element,p,{relatedTarget:S})};this._queueCallback(_e,this._element,!0)}hide(){if(!this._isShown||r.trigger(this._element,g).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(P),this._backdrop.hide();let O=()=>{this._element.classList.remove(v,P),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new a().reset(),r.trigger(this._element,T)};this._queueCallback(O,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let S=()=>{if(this._config.backdrop==="static"){r.trigger(this._element,k);return}this.hide()},O=!!this._config.backdrop;return new t({className:E,isVisible:O,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:O?S:null})}_initializeFocusTrap(){return new n({trapElement:this._element})}_addEventListeners(){r.on(this._element,m,S=>{if(S.key===f){if(this._config.keyboard){this.hide();return}r.trigger(this._element,k)}})}static jQueryInterface(S){return this.each(function(){let O=I.getOrCreateInstance(this,S);if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S](this)}})}}return r.on(document,b,C,function(U){let S=e.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&U.preventDefault(),o.isDisabled(this))return;r.one(S,T,()=>{o.isVisible(this)&&this.focus()});let O=e.findOne(w);O&&O!==S&&I.getInstance(O).hide(),I.getOrCreateInstance(S).toggle(this)}),r.on(window,_,()=>{for(let U of e.find(w))I.getOrCreateInstance(U).show()}),r.on(window,h,()=>{for(let U of e.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(U).position!=="fixed"&&I.getOrCreateInstance(U).hide()}),i.enableDismissTrigger(I),o.defineJQueryPlugin(I),I})});var Se=class{validateSignature(r){return Promise.resolve(null)}validateAtHash(r){return Promise.resolve(!0)}},Ce=class{};var me=class{},fs=(()=>{class s extends me{now(){return Date.now()}new(){return new Date}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=It(s)))(i||s)}})()}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})();var Ee=class{},Ie=class{},ms=(()=>{class s{constructor(){this.data=new Map}getItem(e){return this.data.get(e)}removeItem(e){this.data.delete(e)}setItem(e,t){this.data.set(e,t)}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})();var pe=class{constructor(r){this.type=r}},H=class extends pe{constructor(r,e=null){super(r),this.info=e}},q=class extends pe{constructor(r,e=null){super(r),this.info=e}},A=class extends pe{constructor(r,e,t=null){super(r),this.reason=e,this.params=t}};function Jt(s){let r=s.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(r).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function Yt(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var ie=class{constructor(r){this.clientId="",this.redirectUri="",this.postLogoutRedirectUri="",this.redirectUriAsPostLogoutRedirectUriFallback=!0,this.loginUrl="",this.scope="openid profile",this.resource="",this.rngUrl="",this.oidc=!0,this.requestAccessToken=!0,this.options=null,this.issuer="",this.logoutUrl="",this.clearHashAfterLogin=!0,this.tokenEndpoint=null,this.revocationEndpoint=null,this.customTokenParameters=[],this.userinfoEndpoint=null,this.responseType="",this.showDebugInformation=!1,this.silentRefreshRedirectUri="",this.silentRefreshMessagePrefix="",this.silentRefreshShowIFrame=!1,this.siletRefreshTimeout=1e3*20,this.silentRefreshTimeout=1e3*20,this.dummyClientSecret="",this.requireHttps="remoteOnly",this.strictDiscoveryDocumentValidation=!0,this.jwks=null,this.customQueryParams=null,this.silentRefreshIFrameName="angular-oauth-oidc-silent-refresh-iframe",this.timeoutFactor=.75,this.sessionChecksEnabled=!1,this.sessionCheckIntervall=3*1e3,this.sessionCheckIFrameUrl=null,this.sessionCheckIFrameName="angular-oauth-oidc-check-session-iframe",this.disableAtHashCheck=!1,this.skipSubjectCheck=!1,this.useIdTokenHintForSilentRefresh=!1,this.skipIssuerCheck=!1,this.nonceStateSeparator=";",this.useHttpBasicAuth=!1,this.decreaseExpirationBySec=0,this.waitForTokenInMsec=0,this.disablePKCE=!1,this.preserveRequestedRoute=!1,this.disableIdTokenTimer=!1,this.checkOrigin=!1,this.openUri=e=>{location.href=e},r&&Object.assign(this,r)}},Y=class{encodeKey(r){return encodeURIComponent(r)}encodeValue(r){return encodeURIComponent(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}},Ae=class{};var Gt=(()=>{class s{getHashFragmentParams(e){let t=e||window.location.hash;if(t=decodeURIComponent(t),t.indexOf("#")!==0)return{};let i=t.indexOf("?");return i>-1?t=t.substr(i+1):t=t.substr(1),this.parseQueryString(t)}parseQueryString(e){let t={},i,n,o,a,l,u;if(e===null)return t;let d=e.split("&");for(let c=0;c<d.length;c++)i=d[c],n=i.indexOf("="),n===-1?(o=i,a=null):(o=i.substr(0,n),a=i.substr(n+1)),l=decodeURIComponent(o),u=decodeURIComponent(a),l.substr(0,1)==="/"&&(l=l.substr(1)),t[l]=u;return t}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})(),Xt=32,ps=64,gs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function je(s,r,e,t,i){let n,o,a,l,u,d,c,_,f,v,y,P,E;for(;i>=64;){for(n=r[0],o=r[1],a=r[2],l=r[3],u=r[4],d=r[5],c=r[6],_=r[7],v=0;v<16;v++)y=t+v*4,s[v]=(e[y]&255)<<24|(e[y+1]&255)<<16|(e[y+2]&255)<<8|e[y+3]&255;for(v=16;v<64;v++)f=s[v-2],P=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,f=s[v-15],E=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,s[v]=(P+s[v-7]|0)+(E+s[v-16]|0);for(v=0;v<64;v++)P=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&d^~u&c)|0)+(_+(gs[v]+s[v]|0)|0)|0,E=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&o^n&a^o&a)|0,_=c,c=d,d=u,u=l+P|0,l=a,a=o,o=n,n=P+E|0;r[0]+=n,r[1]+=o,r[2]+=a,r[3]+=l,r[4]+=u,r[5]+=d,r[6]+=c,r[7]+=_,t+=64,i-=64}return t}var Me=class{constructor(){this.digestLength=Xt,this.blockSize=ps,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}reset(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this}clean(){for(let r=0;r<this.buffer.length;r++)this.buffer[r]=0;for(let r=0;r<this.temp.length;r++)this.temp[r]=0;this.reset()}update(r,e=r.length){if(this.finished)throw new Error("SHA256: can't update because hash was finished.");let t=0;if(this.bytesHashed+=e,this.bufferLength>0){for(;this.bufferLength<64&&e>0;)this.buffer[this.bufferLength++]=r[t++],e--;this.bufferLength===64&&(je(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(e>=64&&(t=je(this.temp,this.state,r,t,e),e%=64);e>0;)this.buffer[this.bufferLength++]=r[t++],e--;return this}finish(r){if(!this.finished){let e=this.bytesHashed,t=this.bufferLength,i=e/536870912|0,n=e<<3,o=e%64<56?64:128;this.buffer[t]=128;for(let a=t+1;a<o-8;a++)this.buffer[a]=0;this.buffer[o-8]=i>>>24&255,this.buffer[o-7]=i>>>16&255,this.buffer[o-6]=i>>>8&255,this.buffer[o-5]=i>>>0&255,this.buffer[o-4]=n>>>24&255,this.buffer[o-3]=n>>>16&255,this.buffer[o-2]=n>>>8&255,this.buffer[o-1]=n>>>0&255,je(this.temp,this.state,this.buffer,0,o),this.finished=!0}for(let e=0;e<8;e++)r[e*4+0]=this.state[e]>>>24&255,r[e*4+1]=this.state[e]>>>16&255,r[e*4+2]=this.state[e]>>>8&255,r[e*4+3]=this.state[e]>>>0&255;return this}digest(){let r=new Uint8Array(this.digestLength);return this.finish(r),r}_saveState(r){for(let e=0;e<this.state.length;e++)r[e]=this.state[e]}_restoreState(r,e){for(let t=0;t<this.state.length;t++)this.state[t]=r[t];this.bytesHashed=e,this.finished=!1,this.bufferLength=0}};function _s(s){let r=new Me().update(s),e=r.digest();return r.clean(),e}var Js=new Uint8Array(Xt);var xe=class{};function bs(s){if(typeof s!="string")throw new TypeError("expected string");let r=s,e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}function vs(s){let r=[];for(let e=0;e<s.length;e++)r.push(String.fromCharCode(s[e]));return r.join("")}var ks=(()=>{class s{async calcHash(e,t){return vs(_s(bs(e)))}toHashString2(e){let t="";for(let i of e)t+=String.fromCharCode(i);return t}toHashString(e){let t=new Uint8Array(e),i="";for(let n of t)i+=String.fromCharCode(n);return i}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})(),ne=(()=>{class s extends ie{constructor(e,t,i,n,o,a,l,u,d,c){super(),this.ngZone=e,this.http=t,this.config=o,this.urlHelper=a,this.logger=l,this.crypto=u,this.dateTimeService=c,this.discoveryDocumentLoaded=!1,this.state="",this.eventsSubject=new He,this.discoveryDocumentLoadedSubject=new He,this.grantTypesSupported=[],this.inImplicitFlow=!1,this.saveNoncesInLocalStorage=!1,this.debug("angular-oauth2-oidc v10"),this.document=d,o||(o={}),this.discoveryDocumentLoaded$=this.discoveryDocumentLoadedSubject.asObservable(),this.events=this.eventsSubject.asObservable(),n&&(this.tokenValidationHandler=n),o&&this.configure(o);try{i?this.setStorage(i):typeof sessionStorage<"u"&&this.setStorage(sessionStorage)}catch(_){console.error("No OAuthStorage provided and cannot access default (sessionStorage).Consider providing a custom OAuthStorage implementation in your module.",_)}if(this.checkLocalStorageAccessable()){let _=window?.navigator?.userAgent;(_?.includes("MSIE ")||_?.includes("Trident"))&&(this.saveNoncesInLocalStorage=!0)}this.setupRefreshTimer()}checkLocalStorageAccessable(){if(typeof window>"u")return!1;let e="test";try{return typeof window.localStorage>"u"?!1:(localStorage.setItem(e,e),localStorage.removeItem(e),!0)}catch{return!1}}configure(e){Object.assign(this,new ie,e),this.config=Object.assign({},new ie,e),this.sessionChecksEnabled&&this.setupSessionCheck(),this.configChanged()}configChanged(){this.setupRefreshTimer()}restartSessionChecksIfStillLoggedIn(){this.hasValidIdToken()&&this.initSessionCheck()}restartRefreshTimerIfStillLoggedIn(){this.setupExpirationTimers()}setupSessionCheck(){this.events.pipe(F(e=>e.type==="token_received")).subscribe(()=>{this.initSessionCheck()})}setupAutomaticSilentRefresh(e={},t,i=!0){let n=!0;this.clearAutomaticRefreshTimer(),this.automaticRefreshSubscription=this.events.pipe(Re(o=>{o.type==="token_received"?n=!0:o.type==="logout"&&(n=!1)}),F(o=>o.type==="token_expires"&&(t==null||t==="any"||o.info===t)),gt(1e3)).subscribe(()=>{n&&this.refreshInternal(e,i).catch(()=>{this.debug("Automatic silent refresh did not work")})}),this.restartRefreshTimerIfStillLoggedIn()}refreshInternal(e,t){return!this.useSilentRefresh&&this.responseType==="code"?this.refreshToken():this.silentRefresh(e,t)}loadDiscoveryDocumentAndTryLogin(e=null){return this.loadDiscoveryDocument().then(()=>this.tryLogin(e))}loadDiscoveryDocumentAndLogin(e=null){return e=e||{},this.loadDiscoveryDocumentAndTryLogin(e).then(()=>{if(!this.hasValidIdToken()||!this.hasValidAccessToken()){let t=typeof e.state=="string"?e.state:"";return this.initLoginFlow(t),!1}else return!0})}debug(...e){this.showDebugInformation&&this.logger.debug(...e)}validateUrlFromDiscoveryDocument(e){let t=[],i=this.validateUrlForHttps(e),n=this.validateUrlAgainstIssuer(e);return i||t.push("https for all urls required. Also for urls received by discovery."),n||t.push("Every url in discovery document has to start with the issuer url.Also see property strictDiscoveryDocumentValidation."),t}validateUrlForHttps(e){if(!e)return!0;let t=e.toLowerCase();return this.requireHttps===!1||(t.match(/^http:\/\/localhost($|[:/])/)||t.match(/^http:\/\/localhost($|[:/])/))&&this.requireHttps==="remoteOnly"?!0:t.startsWith("https://")}assertUrlNotNullAndCorrectProtocol(e,t){if(!e)throw new Error(`'${t}' should not be null`);if(!this.validateUrlForHttps(e))throw new Error(`'${t}' must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).`)}validateUrlAgainstIssuer(e){return!this.strictDiscoveryDocumentValidation||!e?!0:e.toLowerCase().startsWith(this.issuer.toLowerCase())}setupRefreshTimer(){if(typeof window>"u"){this.debug("timer not supported on this plattform");return}(this.hasValidIdToken()||this.hasValidAccessToken())&&(this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.setupExpirationTimers()),this.tokenReceivedSubscription&&this.tokenReceivedSubscription.unsubscribe(),this.tokenReceivedSubscription=this.events.pipe(F(e=>e.type==="token_received")).subscribe(()=>{this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.setupExpirationTimers()})}setupExpirationTimers(){this.hasValidAccessToken()&&this.setupAccessTokenTimer(),!this.disableIdTokenTimer&&this.hasValidIdToken()&&this.setupIdTokenTimer()}setupAccessTokenTimer(){let e=this.getAccessTokenExpiration(),t=this.getAccessTokenStoredAt(),i=this.calcTimeout(t,e);this.ngZone.runOutsideAngular(()=>{this.accessTokenTimeoutSubscription=$(new q("token_expires","access_token")).pipe(ke(i)).subscribe(n=>{this.ngZone.run(()=>{this.eventsSubject.next(n)})})})}setupIdTokenTimer(){let e=this.getIdTokenExpiration(),t=this.getIdTokenStoredAt(),i=this.calcTimeout(t,e);this.ngZone.runOutsideAngular(()=>{this.idTokenTimeoutSubscription=$(new q("token_expires","id_token")).pipe(ke(i)).subscribe(n=>{this.ngZone.run(()=>{this.eventsSubject.next(n)})})})}stopAutomaticRefresh(){this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.clearAutomaticRefreshTimer()}clearAccessTokenTimer(){this.accessTokenTimeoutSubscription&&this.accessTokenTimeoutSubscription.unsubscribe()}clearIdTokenTimer(){this.idTokenTimeoutSubscription&&this.idTokenTimeoutSubscription.unsubscribe()}clearAutomaticRefreshTimer(){this.automaticRefreshSubscription&&this.automaticRefreshSubscription.unsubscribe()}calcTimeout(e,t){let i=this.dateTimeService.now(),n=(t-e)*this.timeoutFactor-(i-e),o=Math.max(0,n),a=2147483647;return o>a?a:o}setStorage(e){this._storage=e,this.configChanged()}loadDiscoveryDocument(e=null){return new Promise((t,i)=>{if(e||(e=this.issuer||"",e.endsWith("/")||(e+="/"),e+=".well-known/openid-configuration"),!this.validateUrlForHttps(e)){i("issuer  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");return}this.http.get(e).subscribe(n=>{if(!this.validateDiscoveryDocument(n)){this.eventsSubject.next(new A("discovery_document_validation_error",null)),i("discovery_document_validation_error");return}this.loginUrl=n.authorization_endpoint,this.logoutUrl=n.end_session_endpoint||this.logoutUrl,this.grantTypesSupported=n.grant_types_supported,this.issuer=n.issuer,this.tokenEndpoint=n.token_endpoint,this.userinfoEndpoint=n.userinfo_endpoint||this.userinfoEndpoint,this.jwksUri=n.jwks_uri,this.sessionCheckIFrameUrl=n.check_session_iframe||this.sessionCheckIFrameUrl,this.discoveryDocumentLoaded=!0,this.discoveryDocumentLoadedSubject.next(n),this.revocationEndpoint=n.revocation_endpoint||this.revocationEndpoint,this.sessionChecksEnabled&&this.restartSessionChecksIfStillLoggedIn(),this.loadJwks().then(o=>{let a={discoveryDocument:n,jwks:o},l=new H("discovery_document_loaded",a);this.eventsSubject.next(l),t(l)}).catch(o=>{this.eventsSubject.next(new A("discovery_document_load_error",o)),i(o)})},n=>{this.logger.error("error loading discovery document",n),this.eventsSubject.next(new A("discovery_document_load_error",n)),i(n)})})}loadJwks(){return new Promise((e,t)=>{this.jwksUri?this.http.get(this.jwksUri).subscribe(i=>{this.jwks=i,e(i)},i=>{this.logger.error("error loading jwks",i),this.eventsSubject.next(new A("jwks_load_error",i)),t(i)}):e(null)})}validateDiscoveryDocument(e){let t;return!this.skipIssuerCheck&&e.issuer!==this.issuer?(this.logger.error("invalid issuer in discovery document","expected: "+this.issuer,"current: "+e.issuer),!1):(t=this.validateUrlFromDiscoveryDocument(e.authorization_endpoint),t.length>0?(this.logger.error("error validating authorization_endpoint in discovery document",t),!1):(t=this.validateUrlFromDiscoveryDocument(e.end_session_endpoint),t.length>0?(this.logger.error("error validating end_session_endpoint in discovery document",t),!1):(t=this.validateUrlFromDiscoveryDocument(e.token_endpoint),t.length>0&&this.logger.error("error validating token_endpoint in discovery document",t),t=this.validateUrlFromDiscoveryDocument(e.revocation_endpoint),t.length>0&&this.logger.error("error validating revocation_endpoint in discovery document",t),t=this.validateUrlFromDiscoveryDocument(e.userinfo_endpoint),t.length>0?(this.logger.error("error validating userinfo_endpoint in discovery document",t),!1):(t=this.validateUrlFromDiscoveryDocument(e.jwks_uri),t.length>0?(this.logger.error("error validating jwks_uri in discovery document",t),!1):(this.sessionChecksEnabled&&!e.check_session_iframe&&this.logger.warn("sessionChecksEnabled is activated but discovery document does not contain a check_session_iframe field"),!0)))))}fetchTokenUsingPasswordFlowAndLoadUserProfile(e,t,i=new Q){return this.fetchTokenUsingPasswordFlow(e,t,i).then(()=>this.loadUserProfile())}loadUserProfile(){if(!this.hasValidAccessToken())throw new Error("Can not load User Profile without access_token");if(!this.validateUrlForHttps(this.userinfoEndpoint))throw new Error("userinfoEndpoint must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");return new Promise((e,t)=>{let i=new Q().set("Authorization","Bearer "+this.getAccessToken());this.http.get(this.userinfoEndpoint,{headers:i,observe:"response",responseType:"text"}).subscribe(n=>{if(this.debug("userinfo received",JSON.stringify(n)),n.headers.get("content-type").startsWith("application/json")){let o=JSON.parse(n.body),a=this.getIdentityClaims()||{};if(!this.skipSubjectCheck&&this.oidc&&(!a.sub||o.sub!==a.sub)){t(`if property oidc is true, the received user-id (sub) has to be the user-id of the user that has logged in with oidc.
if you are not using oidc but just oauth2 password flow set oidc to false`);return}o=Object.assign({},a,o),this._storage.setItem("id_token_claims_obj",JSON.stringify(o)),this.eventsSubject.next(new H("user_profile_loaded")),e({info:o})}else this.debug("userinfo is not JSON, treating it as JWE/JWS"),this.eventsSubject.next(new H("user_profile_loaded")),e(JSON.parse(n.body))},n=>{this.logger.error("error loading user info",n),this.eventsSubject.next(new A("user_profile_load_error",n)),t(n)})})}fetchTokenUsingPasswordFlow(e,t,i=new Q){let n={username:e,password:t};return this.fetchTokenUsingGrant("password",n,i)}fetchTokenUsingGrant(e,t,i=new Q){this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint");let n=new se({encoder:new Y}).set("grant_type",e).set("scope",this.scope);if(this.useHttpBasicAuth){let o=btoa(`${this.clientId}:${this.dummyClientSecret}`);i=i.set("Authorization","Basic "+o)}if(this.useHttpBasicAuth||(n=n.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(n=n.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let o of Object.getOwnPropertyNames(this.customQueryParams))n=n.set(o,this.customQueryParams[o]);for(let o of Object.keys(t))n=n.set(o,t[o]);return i=i.set("Content-Type","application/x-www-form-urlencoded"),new Promise((o,a)=>{this.http.post(this.tokenEndpoint,n,{headers:i}).subscribe(l=>{this.debug("tokenResponse",l),this.storeAccessTokenResponse(l.access_token,l.refresh_token,l.expires_in||this.fallbackAccessTokenExpirationTimeInSec,l.scope,this.extractRecognizedCustomParameters(l)),this.oidc&&l.id_token&&this.processIdToken(l.id_token,l.access_token).then(u=>{this.storeIdToken(u),o(l)}),this.eventsSubject.next(new H("token_received")),o(l)},l=>{this.logger.error("Error performing ${grantType} flow",l),this.eventsSubject.next(new A("token_error",l)),a(l)})})}refreshToken(){return this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint"),new Promise((e,t)=>{let i=new se({encoder:new Y}).set("grant_type","refresh_token").set("scope",this.scope).set("refresh_token",this._storage.getItem("refresh_token")),n=new Q().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let o=btoa(`${this.clientId}:${this.dummyClientSecret}`);n=n.set("Authorization","Basic "+o)}if(this.useHttpBasicAuth||(i=i.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(i=i.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let o of Object.getOwnPropertyNames(this.customQueryParams))i=i.set(o,this.customQueryParams[o]);this.http.post(this.tokenEndpoint,i,{headers:n}).pipe(bt(o=>this.oidc&&o.id_token?ht(this.processIdToken(o.id_token,o.access_token,!0)).pipe(Re(a=>this.storeIdToken(a)),ve(()=>o)):$(o))).subscribe(o=>{this.debug("refresh tokenResponse",o),this.storeAccessTokenResponse(o.access_token,o.refresh_token,o.expires_in||this.fallbackAccessTokenExpirationTimeInSec,o.scope,this.extractRecognizedCustomParameters(o)),this.eventsSubject.next(new H("token_received")),this.eventsSubject.next(new H("token_refreshed")),e(o)},o=>{this.logger.error("Error refreshing token",o),this.eventsSubject.next(new A("token_refresh_error",o)),t(o)})})}removeSilentRefreshEventListener(){this.silentRefreshPostMessageEventListener&&(window.removeEventListener("message",this.silentRefreshPostMessageEventListener),this.silentRefreshPostMessageEventListener=null)}setupSilentRefreshEventListener(){this.removeSilentRefreshEventListener(),this.silentRefreshPostMessageEventListener=e=>{let t=this.processMessageEventMessage(e);this.checkOrigin&&e.origin!==location.origin&&console.error("wrong origin requested silent refresh!"),this.tryLogin({customHashFragment:t,preventClearHashAfterLogin:!0,customRedirectUri:this.silentRefreshRedirectUri||this.redirectUri}).catch(i=>this.debug("tryLogin during silent refresh failed",i))},window.addEventListener("message",this.silentRefreshPostMessageEventListener)}silentRefresh(e={},t=!0){let i=this.getIdentityClaims()||{};if(this.useIdTokenHintForSilentRefresh&&this.hasValidIdToken()&&(e.id_token_hint=this.getIdToken()),!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(typeof this.document>"u")throw new Error("silent refresh is not supported on this platform");let n=this.document.getElementById(this.silentRefreshIFrameName);n&&this.document.body.removeChild(n),this.silentRefreshSubject=i.sub;let o=this.document.createElement("iframe");o.id=this.silentRefreshIFrameName,this.setupSilentRefreshEventListener();let a=this.silentRefreshRedirectUri||this.redirectUri;this.createLoginUrl(null,null,a,t,e).then(c=>{o.setAttribute("src",c),this.silentRefreshShowIFrame||(o.style.display="none"),this.document.body.appendChild(o)});let l=this.events.pipe(F(c=>c instanceof A),we()),u=this.events.pipe(F(c=>c.type==="token_received"),we()),d=$(new A("silent_refresh_timeout",null)).pipe(ke(this.silentRefreshTimeout));return pt([l,u,d]).pipe(ve(c=>{if(c instanceof A)throw c.type==="silent_refresh_timeout"?this.eventsSubject.next(c):(c=new A("silent_refresh_error",c),this.eventsSubject.next(c)),c;return c.type==="token_received"&&(c=new H("silently_refreshed"),this.eventsSubject.next(c)),c})).toPromise()}initImplicitFlowInPopup(e){return this.initLoginFlowInPopup(e)}initLoginFlowInPopup(e){return e=e||{},this.createLoginUrl(null,null,this.silentRefreshRedirectUri,!1,{display:"popup"}).then(t=>new Promise((i,n)=>{let a=null;e.windowRef?e.windowRef&&!e.windowRef.closed&&(a=e.windowRef,a.location.href=t):a=window.open(t,"ngx-oauth2-oidc-login",this.calculatePopupFeatures(e));let l,u=v=>{this.tryLogin({customHashFragment:v,preventClearHashAfterLogin:!0,customRedirectUri:this.silentRefreshRedirectUri}).then(()=>{c(),i(!0)},y=>{c(),n(y)})},d=()=>{(!a||a.closed)&&(c(),n(new A("popup_closed",{})))};a?l=window.setInterval(d,500):n(new A("popup_blocked",{}));let c=()=>{window.clearInterval(l),window.removeEventListener("storage",f),window.removeEventListener("message",_),a!==null&&a.close(),a=null},_=v=>{let y=this.processMessageEventMessage(v);y&&y!==null?(window.removeEventListener("storage",f),u(y)):console.log("false event firing")},f=v=>{v.key==="auth_hash"&&(window.removeEventListener("message",_),u(v.newValue))};window.addEventListener("message",_),window.addEventListener("storage",f)}))}calculatePopupFeatures(e){let t=e.height||470,i=e.width||500,n=window.screenLeft+(window.outerWidth-i)/2,o=window.screenTop+(window.outerHeight-t)/2;return`location=no,toolbar=no,width=${i},height=${t},top=${o},left=${n}`}processMessageEventMessage(e){let t="#";if(this.silentRefreshMessagePrefix&&(t+=this.silentRefreshMessagePrefix),!e||!e.data||typeof e.data!="string")return;let i=e.data;if(i.startsWith(t))return"#"+i.substr(t.length)}canPerformSessionCheck(){return this.sessionChecksEnabled?this.sessionCheckIFrameUrl?this.getSessionState()?!(typeof this.document>"u"):(console.warn("sessionChecksEnabled is activated but there is no session_state"),!1):(console.warn("sessionChecksEnabled is activated but there is no sessionCheckIFrameUrl"),!1):!1}setupSessionCheckEventListener(){this.removeSessionCheckEventListener(),this.sessionCheckEventListener=e=>{let t=e.origin.toLowerCase(),i=this.issuer.toLowerCase();if(this.debug("sessionCheckEventListener"),!i.startsWith(t)){this.debug("sessionCheckEventListener","wrong origin",t,"expected",i,"event",e);return}switch(e.data){case"unchanged":this.ngZone.run(()=>{this.handleSessionUnchanged()});break;case"changed":this.ngZone.run(()=>{this.handleSessionChange()});break;case"error":this.ngZone.run(()=>{this.handleSessionError()});break}this.debug("got info from session check inframe",e)},this.ngZone.runOutsideAngular(()=>{window.addEventListener("message",this.sessionCheckEventListener)})}handleSessionUnchanged(){this.debug("session check","session unchanged"),this.eventsSubject.next(new q("session_unchanged"))}handleSessionChange(){this.eventsSubject.next(new q("session_changed")),this.stopSessionCheckTimer(),!this.useSilentRefresh&&this.responseType==="code"?this.refreshToken().then(()=>{this.debug("token refresh after session change worked")}).catch(()=>{this.debug("token refresh did not work after session changed"),this.eventsSubject.next(new q("session_terminated")),this.logOut(!0)}):this.silentRefreshRedirectUri?(this.silentRefresh().catch(()=>this.debug("silent refresh failed after session changed")),this.waitForSilentRefreshAfterSessionChange()):(this.eventsSubject.next(new q("session_terminated")),this.logOut(!0))}waitForSilentRefreshAfterSessionChange(){this.events.pipe(F(e=>e.type==="silently_refreshed"||e.type==="silent_refresh_timeout"||e.type==="silent_refresh_error"),we()).subscribe(e=>{e.type!=="silently_refreshed"&&(this.debug("silent refresh did not work after session changed"),this.eventsSubject.next(new q("session_terminated")),this.logOut(!0))})}handleSessionError(){this.stopSessionCheckTimer(),this.eventsSubject.next(new q("session_error"))}removeSessionCheckEventListener(){this.sessionCheckEventListener&&(window.removeEventListener("message",this.sessionCheckEventListener),this.sessionCheckEventListener=null)}initSessionCheck(){if(!this.canPerformSessionCheck())return;let e=this.document.getElementById(this.sessionCheckIFrameName);e&&this.document.body.removeChild(e);let t=this.document.createElement("iframe");t.id=this.sessionCheckIFrameName,this.setupSessionCheckEventListener();let i=this.sessionCheckIFrameUrl;t.setAttribute("src",i),t.style.display="none",this.document.body.appendChild(t),this.startSessionCheckTimer()}startSessionCheckTimer(){this.stopSessionCheckTimer(),this.ngZone.runOutsideAngular(()=>{this.sessionCheckTimer=setInterval(this.checkSession.bind(this),this.sessionCheckIntervall)})}stopSessionCheckTimer(){this.sessionCheckTimer&&(clearInterval(this.sessionCheckTimer),this.sessionCheckTimer=null)}checkSession(){let e=this.document.getElementById(this.sessionCheckIFrameName);e||this.logger.warn("checkSession did not find iframe",this.sessionCheckIFrameName);let t=this.getSessionState();t||this.stopSessionCheckTimer();let i=this.clientId+" "+t;e.contentWindow.postMessage(i,this.issuer)}async createLoginUrl(e="",t="",i="",n=!1,o={}){let a=this,l;i?l=i:l=this.redirectUri;let u=await this.createAndSaveNonce();if(e?e=u+this.config.nonceStateSeparator+encodeURIComponent(e):e=u,!this.requestAccessToken&&!this.oidc)throw new Error("Either requestAccessToken or oidc or both must be true");this.config.responseType?this.responseType=this.config.responseType:this.oidc&&this.requestAccessToken?this.responseType="id_token token":this.oidc&&!this.requestAccessToken?this.responseType="id_token":this.responseType="token";let d=a.loginUrl.indexOf("?")>-1?"&":"?",c=a.scope;this.oidc&&!c.match(/(^|\s)openid($|\s)/)&&(c="openid "+c);let _=a.loginUrl+d+"response_type="+encodeURIComponent(a.responseType)+"&client_id="+encodeURIComponent(a.clientId)+"&state="+encodeURIComponent(e)+"&redirect_uri="+encodeURIComponent(l)+"&scope="+encodeURIComponent(c);if(this.responseType.includes("code")&&!this.disablePKCE){let[f,v]=await this.createChallangeVerifierPairForPKCE();this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?localStorage.setItem("PKCE_verifier",v):this._storage.setItem("PKCE_verifier",v),_+="&code_challenge="+f,_+="&code_challenge_method=S256"}t&&(_+="&login_hint="+encodeURIComponent(t)),a.resource&&(_+="&resource="+encodeURIComponent(a.resource)),a.oidc&&(_+="&nonce="+encodeURIComponent(u)),n&&(_+="&prompt=none");for(let f of Object.keys(o))_+="&"+encodeURIComponent(f)+"="+encodeURIComponent(o[f]);if(this.customQueryParams)for(let f of Object.getOwnPropertyNames(this.customQueryParams))_+="&"+f+"="+encodeURIComponent(this.customQueryParams[f]);return _}initImplicitFlowInternal(e="",t=""){if(this.inImplicitFlow)return;if(this.inImplicitFlow=!0,!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");let i={},n=null;typeof t=="string"?n=t:typeof t=="object"&&(i=t),this.createLoginUrl(e,n,null,!1,i).then(this.config.openUri).catch(o=>{console.error("Error in initImplicitFlow",o),this.inImplicitFlow=!1})}initImplicitFlow(e="",t=""){this.loginUrl!==""?this.initImplicitFlowInternal(e,t):this.events.pipe(F(i=>i.type==="discovery_document_loaded")).subscribe(()=>this.initImplicitFlowInternal(e,t))}resetImplicitFlow(){this.inImplicitFlow=!1}callOnTokenReceivedIfExists(e){let t=this;if(e.onTokenReceived){let i={idClaims:t.getIdentityClaims(),idToken:t.getIdToken(),accessToken:t.getAccessToken(),state:t.state};e.onTokenReceived(i)}}storeAccessTokenResponse(e,t,i,n,o){if(this._storage.setItem("access_token",e),n&&!Array.isArray(n)?this._storage.setItem("granted_scopes",JSON.stringify(n.split(" "))):n&&Array.isArray(n)&&this._storage.setItem("granted_scopes",JSON.stringify(n)),this._storage.setItem("access_token_stored_at",""+this.dateTimeService.now()),i){let a=i*1e3,u=this.dateTimeService.new().getTime()+a;this._storage.setItem("expires_at",""+u)}t&&this._storage.setItem("refresh_token",t),o&&o.forEach((a,l)=>{this._storage.setItem(l,a)})}tryLogin(e=null){return this.config.responseType==="code"?this.tryLoginCodeFlow(e).then(()=>!0):this.tryLoginImplicitFlow(e)}parseQueryString(e){return!e||e.length===0?{}:(e.charAt(0)==="?"&&(e=e.substr(1)),this.urlHelper.parseQueryString(e))}async tryLoginCodeFlow(e=null){e=e||{};let t=e.customHashFragment?e.customHashFragment.substring(1):window.location.search,i=this.getCodePartsFromUrl(t),n=i.code,o=i.state,a=i.session_state;if(!e.preventClearHashAfterLogin){let d=location.origin+location.pathname+location.search.replace(/code=[^&$]*/,"").replace(/scope=[^&$]*/,"").replace(/state=[^&$]*/,"").replace(/session_state=[^&$]*/,"").replace(/^\?&/,"?").replace(/&$/,"").replace(/^\?$/,"").replace(/&+/g,"&").replace(/\?&/,"?").replace(/\?$/,"")+location.hash;history.replaceState(null,window.name,d)}let[l,u]=this.parseState(o);if(this.state=u,i.error){this.debug("error trying to login"),this.handleLoginError(e,i);let d=new A("code_error",{},i);return this.eventsSubject.next(d),Promise.reject(d)}if(!e.disableNonceCheck){if(!l)return this.saveRequestedRoute(),Promise.resolve();if(!e.disableOAuth2StateCheck&&!this.validateNonce(l)){let c=new A("invalid_nonce_in_state",null);return this.eventsSubject.next(c),Promise.reject(c)}}return this.storeSessionState(a),n&&(await this.getTokenFromCode(n,e),this.restoreRequestedRoute()),Promise.resolve()}saveRequestedRoute(){this.config.preserveRequestedRoute&&this._storage.setItem("requested_route",window.location.pathname+window.location.search)}restoreRequestedRoute(){let e=this._storage.getItem("requested_route");e&&history.replaceState(null,"",window.location.origin+e)}getCodePartsFromUrl(e){return!e||e.length===0?this.urlHelper.getHashFragmentParams():(e.charAt(0)==="?"&&(e=e.substr(1)),this.urlHelper.parseQueryString(e))}getTokenFromCode(e,t){let i=new se({encoder:new Y}).set("grant_type","authorization_code").set("code",e).set("redirect_uri",t.customRedirectUri||this.redirectUri);if(!this.disablePKCE){let n;this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?n=localStorage.getItem("PKCE_verifier"):n=this._storage.getItem("PKCE_verifier"),n?i=i.set("code_verifier",n):console.warn("No PKCE verifier found in oauth storage!")}return this.fetchAndProcessToken(i,t)}fetchAndProcessToken(e,t){t=t||{},this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint");let i=new Q().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let n=btoa(`${this.clientId}:${this.dummyClientSecret}`);i=i.set("Authorization","Basic "+n)}return this.useHttpBasicAuth||(e=e.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(e=e.set("client_secret",this.dummyClientSecret)),new Promise((n,o)=>{if(this.customQueryParams)for(let a of Object.getOwnPropertyNames(this.customQueryParams))e=e.set(a,this.customQueryParams[a]);this.http.post(this.tokenEndpoint,e,{headers:i}).subscribe(a=>{this.debug("refresh tokenResponse",a),this.storeAccessTokenResponse(a.access_token,a.refresh_token,a.expires_in||this.fallbackAccessTokenExpirationTimeInSec,a.scope,this.extractRecognizedCustomParameters(a)),this.oidc&&a.id_token?this.processIdToken(a.id_token,a.access_token,t.disableNonceCheck).then(l=>{this.storeIdToken(l),this.eventsSubject.next(new H("token_received")),this.eventsSubject.next(new H("token_refreshed")),n(a)}).catch(l=>{this.eventsSubject.next(new A("token_validation_error",l)),console.error("Error validating tokens"),console.error(l),o(l)}):(this.eventsSubject.next(new H("token_received")),this.eventsSubject.next(new H("token_refreshed")),n(a))},a=>{console.error("Error getting token",a),this.eventsSubject.next(new A("token_error",a)),o(a)})})}tryLoginImplicitFlow(e=null){e=e||{};let t;e.customHashFragment?t=this.urlHelper.getHashFragmentParams(e.customHashFragment):t=this.urlHelper.getHashFragmentParams(),this.debug("parsed url",t);let i=t.state,[n,o]=this.parseState(i);if(this.state=o,t.error){this.debug("error trying to login"),this.handleLoginError(e,t);let c=new A("token_error",{},t);return this.eventsSubject.next(c),Promise.reject(c)}let a=t.access_token,l=t.id_token,u=t.session_state,d=t.scope;if(!this.requestAccessToken&&!this.oidc)return Promise.reject("Either requestAccessToken or oidc (or both) must be true.");if(this.requestAccessToken&&!a||this.requestAccessToken&&!e.disableOAuth2StateCheck&&!i||this.oidc&&!l)return Promise.resolve(!1);if(this.sessionChecksEnabled&&!u&&this.logger.warn("session checks (Session Status Change Notification) were activated in the configuration but the id_token does not contain a session_state claim"),this.requestAccessToken&&!e.disableNonceCheck&&!this.validateNonce(n)){let _=new A("invalid_nonce_in_state",null);return this.eventsSubject.next(_),Promise.reject(_)}return this.requestAccessToken&&this.storeAccessTokenResponse(a,null,t.expires_in||this.fallbackAccessTokenExpirationTimeInSec,d),this.oidc?this.processIdToken(l,a,e.disableNonceCheck).then(c=>e.validationHandler?e.validationHandler({accessToken:a,idClaims:c.idTokenClaims,idToken:c.idToken,state:i}).then(()=>c):c).then(c=>(this.storeIdToken(c),this.storeSessionState(u),this.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&this.clearLocationHash(),this.eventsSubject.next(new H("token_received")),this.callOnTokenReceivedIfExists(e),this.inImplicitFlow=!1,!0)).catch(c=>(this.eventsSubject.next(new A("token_validation_error",c)),this.logger.error("Error validating tokens"),this.logger.error(c),Promise.reject(c))):(this.eventsSubject.next(new H("token_received")),this.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&this.clearLocationHash(),this.callOnTokenReceivedIfExists(e),Promise.resolve(!0))}parseState(e){let t=e,i="";if(e){let n=e.indexOf(this.config.nonceStateSeparator);n>-1&&(t=e.substr(0,n),i=e.substr(n+this.config.nonceStateSeparator.length))}return[t,i]}validateNonce(e){let t;return this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?t=localStorage.getItem("nonce"):t=this._storage.getItem("nonce"),t!==e?(console.error("Validating access_token failed, wrong state/nonce.",t,e),!1):!0}storeIdToken(e){this._storage.setItem("id_token",e.idToken),this._storage.setItem("id_token_claims_obj",e.idTokenClaimsJson),this._storage.setItem("id_token_expires_at",""+e.idTokenExpiresAt),this._storage.setItem("id_token_stored_at",""+this.dateTimeService.now())}storeSessionState(e){this._storage.setItem("session_state",e)}getSessionState(){return this._storage.getItem("session_state")}handleLoginError(e,t){e.onLoginError&&e.onLoginError(t),this.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&this.clearLocationHash()}getClockSkewInMsec(e=6e5){return!this.clockSkewInSec&&this.clockSkewInSec!==0?e:this.clockSkewInSec*1e3}processIdToken(e,t,i=!1){let n=e.split("."),o=this.padBase64(n[0]),a=Jt(o),l=JSON.parse(a),u=this.padBase64(n[1]),d=Jt(u),c=JSON.parse(d),_;if(this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?_=localStorage.getItem("nonce"):_=this._storage.getItem("nonce"),Array.isArray(c.aud)){if(c.aud.every(w=>w!==this.clientId)){let w="Wrong audience: "+c.aud.join(",");return this.logger.warn(w),Promise.reject(w)}}else if(c.aud!==this.clientId){let w="Wrong audience: "+c.aud;return this.logger.warn(w),Promise.reject(w)}if(!c.sub){let w="No sub claim in id_token";return this.logger.warn(w),Promise.reject(w)}if(this.sessionChecksEnabled&&this.silentRefreshSubject&&this.silentRefreshSubject!==c.sub){let w=`After refreshing, we got an id_token for another user (sub). Expected sub: ${this.silentRefreshSubject}, received sub: ${c.sub}`;return this.logger.warn(w),Promise.reject(w)}if(!c.iat){let w="No iat claim in id_token";return this.logger.warn(w),Promise.reject(w)}if(!this.skipIssuerCheck&&c.iss!==this.issuer){let w="Wrong issuer: "+c.iss;return this.logger.warn(w),Promise.reject(w)}if(!i&&c.nonce!==_){let w="Wrong nonce: "+c.nonce;return this.logger.warn(w),Promise.reject(w)}if(Object.prototype.hasOwnProperty.call(this,"responseType")&&(this.responseType==="code"||this.responseType==="id_token")&&(this.disableAtHashCheck=!0),!this.disableAtHashCheck&&this.requestAccessToken&&!c.at_hash){let w="An at_hash is needed!";return this.logger.warn(w),Promise.reject(w)}let f=this.dateTimeService.now(),v=c.iat*1e3,y=c.exp*1e3,P=this.getClockSkewInMsec();if(v-P>=f||y+P-this.decreaseExpirationBySec<=f){let w="Token has expired";return console.error(w),console.error({now:f,issuedAtMSec:v,expiresAtMSec:y}),Promise.reject(w)}let E={accessToken:t,idToken:e,jwks:this.jwks,idTokenClaims:c,idTokenHeader:l,loadKeys:()=>this.loadJwks()};return this.disableAtHashCheck?this.checkSignature(E).then(()=>({idToken:e,idTokenClaims:c,idTokenClaimsJson:d,idTokenHeader:l,idTokenHeaderJson:a,idTokenExpiresAt:y})):this.checkAtHash(E).then(w=>{if(!this.disableAtHashCheck&&this.requestAccessToken&&!w){let M="Wrong at_hash";return this.logger.warn(M),Promise.reject(M)}return this.checkSignature(E).then(()=>{let M=!this.disableAtHashCheck,p={idToken:e,idTokenClaims:c,idTokenClaimsJson:d,idTokenHeader:l,idTokenHeaderJson:a,idTokenExpiresAt:y};return M?this.checkAtHash(E).then(g=>{if(this.requestAccessToken&&!g){let k="Wrong at_hash";return this.logger.warn(k),Promise.reject(k)}else return p}):p})})}getIdentityClaims(){let e=this._storage.getItem("id_token_claims_obj");return e?JSON.parse(e):null}getGrantedScopes(){let e=this._storage.getItem("granted_scopes");return e?JSON.parse(e):null}getIdToken(){return this._storage?this._storage.getItem("id_token"):null}padBase64(e){for(;e.length%4!==0;)e+="=";return e}getAccessToken(){return this._storage?this._storage.getItem("access_token"):null}getRefreshToken(){return this._storage?this._storage.getItem("refresh_token"):null}getAccessTokenExpiration(){return this._storage.getItem("expires_at")?parseInt(this._storage.getItem("expires_at"),10):null}getAccessTokenStoredAt(){return parseInt(this._storage.getItem("access_token_stored_at"),10)}getIdTokenStoredAt(){return parseInt(this._storage.getItem("id_token_stored_at"),10)}getIdTokenExpiration(){return this._storage.getItem("id_token_expires_at")?parseInt(this._storage.getItem("id_token_expires_at"),10):null}hasValidAccessToken(){if(this.getAccessToken()){let e=this._storage.getItem("expires_at"),t=this.dateTimeService.new();return!(e&&parseInt(e,10)-this.decreaseExpirationBySec<t.getTime()-this.getClockSkewInMsec())}return!1}hasValidIdToken(){if(this.getIdToken()){let e=this._storage.getItem("id_token_expires_at"),t=this.dateTimeService.new();return!(e&&parseInt(e,10)-this.decreaseExpirationBySec<t.getTime()-this.getClockSkewInMsec())}return!1}getCustomTokenResponseProperty(e){return this._storage&&this.config.customTokenParameters&&this.config.customTokenParameters.indexOf(e)>=0&&this._storage.getItem(e)!==null?JSON.parse(this._storage.getItem(e)):null}authorizationHeader(){return"Bearer "+this.getAccessToken()}logOut(e={},t=""){let i=!1;typeof e=="boolean"&&(i=e,e={});let n=this.getIdToken();if(this._storage.removeItem("access_token"),this._storage.removeItem("id_token"),this._storage.removeItem("refresh_token"),this.saveNoncesInLocalStorage?(localStorage.removeItem("nonce"),localStorage.removeItem("PKCE_verifier")):(this._storage.removeItem("nonce"),this._storage.removeItem("PKCE_verifier")),this._storage.removeItem("expires_at"),this._storage.removeItem("id_token_claims_obj"),this._storage.removeItem("id_token_expires_at"),this._storage.removeItem("id_token_stored_at"),this._storage.removeItem("access_token_stored_at"),this._storage.removeItem("granted_scopes"),this._storage.removeItem("session_state"),this.config.customTokenParameters&&this.config.customTokenParameters.forEach(a=>this._storage.removeItem(a)),this.silentRefreshSubject=null,this.eventsSubject.next(new q("logout")),!this.logoutUrl||i)return;let o;if(!this.validateUrlForHttps(this.logoutUrl))throw new Error("logoutUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(this.logoutUrl.indexOf("{{")>-1)o=this.logoutUrl.replace(/\{\{id_token\}\}/,encodeURIComponent(n)).replace(/\{\{client_id\}\}/,encodeURIComponent(this.clientId));else{let a=new se({encoder:new Y});n&&(a=a.set("id_token_hint",n));let l=this.postLogoutRedirectUri||this.redirectUriAsPostLogoutRedirectUriFallback&&this.redirectUri||"";l&&(a=a.set("post_logout_redirect_uri",l),t&&(a=a.set("state",t)));for(let u in e)a=a.set(u,e[u]);o=this.logoutUrl+(this.logoutUrl.indexOf("?")>-1?"&":"?")+a.toString()}this.config.openUri(o)}createAndSaveNonce(){let e=this;return this.createNonce().then(function(t){return e.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?localStorage.setItem("nonce",t):e._storage.setItem("nonce",t),t})}ngOnDestroy(){this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.removeSilentRefreshEventListener();let e=this.document.getElementById(this.silentRefreshIFrameName);e&&e.remove(),this.stopSessionCheckTimer(),this.removeSessionCheckEventListener();let t=this.document.getElementById(this.sessionCheckIFrameName);t&&t.remove()}createNonce(){return new Promise(e=>{if(this.rngUrl)throw new Error("createNonce with rng-web-api has not been implemented so far");let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=45,n="",o=typeof self>"u"?null:self.crypto||self.msCrypto;if(o){let a=new Uint8Array(i);o.getRandomValues(a),a.map||(a.map=Array.prototype.map),a=a.map(l=>t.charCodeAt(l%t.length)),n=String.fromCharCode.apply(null,a)}else for(;0<i--;)n+=t[Math.random()*t.length|0];e(Yt(n))})}async checkAtHash(e){return this.tokenValidationHandler?this.tokenValidationHandler.validateAtHash(e):(this.logger.warn("No tokenValidationHandler configured. Cannot check at_hash."),!0)}checkSignature(e){return this.tokenValidationHandler?this.tokenValidationHandler.validateSignature(e):(this.logger.warn("No tokenValidationHandler configured. Cannot check signature."),Promise.resolve(null))}initLoginFlow(e="",t={}){return this.responseType==="code"?this.initCodeFlow(e,t):this.initImplicitFlow(e,t)}initCodeFlow(e="",t={}){this.loginUrl!==""?this.initCodeFlowInternal(e,t):this.events.pipe(F(i=>i.type==="discovery_document_loaded")).subscribe(()=>this.initCodeFlowInternal(e,t))}initCodeFlowInternal(e="",t={}){if(!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");let i={},n=null;typeof t=="string"?n=t:typeof t=="object"&&(i=t),this.createLoginUrl(e,n,null,!1,i).then(this.config.openUri).catch(o=>{console.error("Error in initAuthorizationCodeFlow"),console.error(o)})}async createChallangeVerifierPairForPKCE(){if(!this.crypto)throw new Error("PKCE support for code flow needs a CryptoHander. Did you import the OAuthModule using forRoot() ?");let e=await this.createNonce(),t=await this.crypto.calcHash(e,"sha-256");return[Yt(t),e]}extractRecognizedCustomParameters(e){let t=new Map;return this.config.customTokenParameters&&this.config.customTokenParameters.forEach(i=>{e[i]&&t.set(i,JSON.stringify(e[i]))}),t}revokeTokenAndLogout(e={},t=!1){let i=this.revocationEndpoint,n=this.getAccessToken(),o=this.getRefreshToken();if(!n)return Promise.resolve();let a=new se({encoder:new Y}),l=new Q().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let u=btoa(`${this.clientId}:${this.dummyClientSecret}`);l=l.set("Authorization","Basic "+u)}if(this.useHttpBasicAuth||(a=a.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(a=a.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let u of Object.getOwnPropertyNames(this.customQueryParams))a=a.set(u,this.customQueryParams[u]);return new Promise((u,d)=>{let c,_;if(n){let f=a.set("token",n).set("token_type_hint","access_token");c=this.http.post(i,f,{headers:l})}else c=$(null);if(o){let f=a.set("token",o).set("token_type_hint","refresh_token");_=this.http.post(i,f,{headers:l})}else _=$(null);t&&(c=c.pipe(G(f=>f.status===0?$(null):be(f))),_=_.pipe(G(f=>f.status===0?$(null):be(f)))),dt([c,_]).subscribe(f=>{this.logOut(e),u(f),this.logger.info("Token successfully revoked")},f=>{this.logger.error("Error revoking token",f),this.eventsSubject.next(new A("token_revoke_error",f)),d(f)})})}clearLocationHash(){location.hash!=""&&(location.hash="")}static{this.\u0275fac=function(t){return new(t||s)(R(St),R(Kt),R(Ie,8),R(Ae,8),R(ie,8),R(Gt),R(Ee),R(xe,8),R(Tt),R(me))}}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})(),Le=class{},Ve=class{handleError(r){return be(r)}},ws=(()=>{class s{constructor(e,t,i){this.oAuthService=e,this.errorHandler=t,this.moduleConfig=i}checkUrl(e){return this.moduleConfig.resourceServer.customUrlValidation?this.moduleConfig.resourceServer.customUrlValidation(e):this.moduleConfig.resourceServer.allowedUrls?!!this.moduleConfig.resourceServer.allowedUrls.find(t=>e.toLowerCase().startsWith(t.toLowerCase())):!0}intercept(e,t){let i=e.url.toLowerCase();return!this.moduleConfig||!this.moduleConfig.resourceServer||!this.checkUrl(i)?t.handle(e):this.moduleConfig.resourceServer.sendAccessToken?mt($(this.oAuthService.getAccessToken()).pipe(F(o=>!!o)),this.oAuthService.events.pipe(F(o=>o.type==="token_received"),ut(this.oAuthService.waitForTokenInMsec||0),G(()=>$(null)),ve(()=>this.oAuthService.getAccessToken()))).pipe(_t(1),ft(o=>{if(o){let a="Bearer "+o,l=e.headers.set("Authorization",a);e=e.clone({headers:l})}return t.handle(e).pipe(G(a=>this.errorHandler.handleError(a)))})):t.handle(e).pipe(G(o=>this.errorHandler.handleError(o)))}static{this.\u0275fac=function(t){return new(t||s)(R(ne),R(Le),R(Ce,8))}}static{this.\u0275prov=J({token:s,factory:s.\u0275fac})}}return s})();function ys(){return console}function Ts(){return typeof sessionStorage<"u"?sessionStorage:new ms}function Ss(s=null,r=Se){return kt([ne,Gt,{provide:Ee,useFactory:ys},{provide:Ie,useFactory:Ts},{provide:Ae,useClass:r},{provide:xe,useClass:ks},{provide:Le,useClass:Ve},{provide:Ce,useValue:s},{provide:qt,useClass:ws,multi:!0},{provide:me,useClass:fs}])}var es=(()=>{class s{static forRoot(e=null,t=Se){return{ngModule:s,providers:[Ss(e,t)]}}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275mod=xt({type:s})}static{this.\u0275inj=vt({imports:[Te]})}}return s})();var ts=[{path:"sessions",loadComponent:()=>import("./chunk-REJZGIU2.js").then(s=>s.SessionsListComponent)},{path:"sessions/new",loadComponent:()=>import("./chunk-LZFJANPR.js").then(s=>s.SessionFormComponent)},{path:"sessions/:id/view",loadComponent:()=>import("./chunk-LZFJANPR.js").then(s=>s.SessionFormComponent)},{path:"sessions/:id/edit",loadComponent:()=>import("./chunk-LZFJANPR.js").then(s=>s.SessionFormComponent)},{path:"sessions/:id/timer",loadComponent:()=>import("./chunk-CCSH72KY.js").then(s=>s.SessionTimerComponent)}];var Es={issuer:"https://accounts.google.com",clientId:"15011162966-3i4v2jjdg1enmaltljltfkl0jj8hkk1n.apps.googleusercontent.com",redirectUri:"https://prideofmithila.github.io/prayatna-ui/",responseType:"code",scope:"openid profile email",tokenEndpoint:"https://localhost:7147/api/Auth/token",strictDiscoveryDocumentValidation:!1,showDebugInformation:!1,usePkce:!0};function Is(s){return()=>(s.configure(Es),s.loadDiscoveryDocument().then(()=>(s.tokenEndpoint="http://prateekkarna-001-site1.qtempurl.com/api/Auth/token",s.setupAutomaticSilentRefresh(),s.tryLogin())))}var ss={providers:[Ct(),Qt(ts),...es.forRoot().providers||[],{provide:Lt,useFactory:Is,deps:[ne],multi:!0}]};var lt=ds(us());var xs=["centerNav"],Ls=["moreBtn"],Ps=["measureContainer"],Ns=["measureItem"];function Ds(s,r){if(s&1&&(L(0,"li",31)(1,"a",32),B(2),D()()),s&2){let e=r.$implicit;j(),W("routerLink",e.route),j(),fe(e.label)}}function Os(s,r){if(s&1){let e=le();Pt(0),L(1,"div",33),K(2,"img",34),L(3,"span",35),B(4),D(),L(5,"button",36),te("click",function(){X(e);let i=he();return ee(i.signOut())}),B(6,"Sign out"),D()(),Nt()}if(s&2){let e=he();j(2),W("src",e.userPicture||"assets/profile.png",At),j(2),fe(e.userName)}}function Us(s,r){if(s&1){let e=le();L(0,"button",37),te("click",function(){X(e);let i=he();return ee(i.signIn())}),B(1,"Sign in"),D()}}function Hs(s,r){if(s&1&&(L(0,"a",38,5),B(2),D()),s&2){let e=r.$implicit;j(2),fe(e.label)}}function Rs(s,r){if(s&1){let e=le();L(0,"li",31)(1,"a",39),te("click",function(){X(e);let i=he();return ee(i.closeOffcanvas())}),B(2),D()()}if(s&2){let e=r.$implicit;j(),W("routerLink",e.route),j(),fe(e.label)}}var Oe=class s{constructor(r,e){this.cdr=r;this.oauthService=e;this.oauthService.events.pipe(F(t=>t?.type==="token_received"||t?.type==="token_refreshed"||t?.type==="session_terminated")).subscribe(()=>{this.updateUserFromToken()})}links=[{label:"Home",route:"/"},{label:"Sessions",route:"/sessions"},{label:"About",route:"/about"},{label:"Services",route:"/services"},{label:"Products",route:"/products"},{label:"Blog",route:"/blog"},{label:"Careers",route:"/careers"},{label:"Contact",route:"/contact"}];offcanvasLinks=[...this.links];visibleCount=this.links.length;isLoggedIn=!1;userName=null;userPicture=null;lastAccessToken=null;_offcanvasInstance=null;resizeObserver;centerNav;moreBtn;measureContainer;measureItems;ngAfterViewInit(){setTimeout(()=>this.computeVisibleLinks(),0),this.resizeObserver=()=>this.computeVisibleLinks(),window.addEventListener("resize",this.resizeObserver),setTimeout(()=>this.updateUserFromToken(!0),0)}ngOnDestroy(){window.removeEventListener("resize",this.resizeObserver)}updateUserFromToken(r=!1){let e=this.oauthService.getAccessToken()||null;if(!e){this.isLoggedIn=!1,this.userName=null,this.userPicture=null,this.lastAccessToken=null,this.cdr.detectChanges();return}!r&&this.lastAccessToken===e||(this.lastAccessToken=e,this.oauthService.loadUserProfile().then(t=>{this.isLoggedIn=!0,this.userName=t?.name||t?.preferred_username||t?.given_name||null,this.userPicture=t?.picture||null,this.cdr.detectChanges()}).catch(()=>{let t=this.oauthService.getIdentityClaims()||{};this.isLoggedIn=!0,this.userName=t.name||t.email||null,this.userPicture=t.picture||null,this.cdr.detectChanges()}))}computeVisibleLinks(){let r=this.centerNav?.nativeElement,e=this.measureContainer?.nativeElement;if(!r||!e){this.visibleCount=this.links.length,this.cdr.detectChanges();return}let t=r.clientWidth-40,i=0,n=0,o=this.measureItems?.toArray()??[];for(let a=0;a<o.length;a++){let l=o[a].nativeElement.offsetWidth;if(i+=l,i<=t)n=a+1;else break}this.visibleCount=n>=1?n:0,this.cdr.detectChanges()}toggleOffcanvas(r,e){r.preventDefault();let t=document.getElementById("offcanvasMenu");if(!t)return;e==="mobile"?this.offcanvasLinks=[...this.links]:e==="more"&&(this.offcanvasLinks=this.links.slice(this.visibleCount)),this.cdr.detectChanges();let n=lt.default.getInstance(t)??new lt.default(t);n.show(),this._offcanvasInstance=n}closeOffcanvas(){this._offcanvasInstance?.hide()}signIn(){this.oauthService.initCodeFlow()}signOut(){this.oauthService.logOut()}static \u0275fac=function(e){return new(e||s)(Fe(jt),Fe(ne))};static \u0275cmp=ye({type:s,selectors:[["app-header"]],viewQuery:function(e,t){if(e&1&&Dt(xs,5,ae)(Ls,5,ae)(Ps,5,ae)(Ns,5,ae),e&2){let i;ue(i=de())&&(t.centerNav=i.first),ue(i=de())&&(t.moreBtn=i.first),ue(i=de())&&(t.measureContainer=i.first),ue(i=de())&&(t.measureItems=i)}},decls:40,vars:11,consts:[["centerNav",""],["moreBtn",""],["signedOut",""],["measureContainer",""],["offcanvasBody",""],["measureItem",""],[1,"navbar","bg-light","shadow-sm"],[1,"container-fluid","px-3"],[1,"d-flex","align-items-center","w-100"],[1,"d-flex","align-items-center",2,"flex","0 0 auto"],["type","button","aria-label","Toggle menu",1,"btn","btn-outline-primary","me-2","d-md-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16","aria-hidden","true","focusable","false",1,"bi","bi-list"],["fill-rule","evenodd","d","M2.5 12.5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5zm0-5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5zm0-5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5z"],["routerLink","/",1,"navbar-brand","d-none","d-md-inline-flex","align-items-center","gap-2"],["src","assets/logo.png","alt","logo","onerror","this.style.display='none'",1,"app-logo"],[1,"fs-5","fw-semibold"],[1,"flex-grow-1","d-none","d-md-flex","justify-content-center","position-relative"],[1,"nav"],["class","nav-item",4,"ngFor","ngForOf"],[1,"btn","btn-link","nav-more","ms-2",3,"click"],[1,"flex-grow-1","text-center","d-md-none"],["routerLink","/",1,"navbar-brand","d-inline-flex","align-items-center","gap-2"],[4,"ngIf","ngIfElse"],[2,"position","absolute","left","-9999px","top","-9999px","visibility","hidden","display","flex","gap","0.5rem"],["class","nav-link measure-item",4,"ngFor","ngForOf"],["tabindex","-1","id","offcanvasMenu","aria-labelledby","offcanvasMenuLabel",1,"offcanvas","offcanvas-start"],[1,"offcanvas-header"],["id","offcanvasMenuLabel",1,"offcanvas-title"],["type","button","data-bs-dismiss","offcanvas","aria-label","Close",1,"btn-close","text-reset"],[1,"offcanvas-body"],[1,"nav","flex-column"],[1,"nav-item"],[1,"nav-link",3,"routerLink"],[1,"d-flex","align-items-center","gap-2"],["alt","profile",1,"rounded-circle","profile-icon",3,"src"],[1,"d-none","d-md-inline"],[1,"btn","btn-link",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"nav-link","measure-item"],[1,"nav-link",3,"click","routerLink"]],template:function(e,t){if(e&1){let i=le();L(0,"nav",6)(1,"div",7)(2,"div",8)(3,"div",9)(4,"button",10),te("click",function(o){return X(i),ee(t.toggleOffcanvas(o,"mobile"))}),wt(),L(5,"svg",11),K(6,"path",12),D()(),yt(),L(7,"a",13),K(8,"img",14),L(9,"span",15),B(10,"Prayatna"),D()()(),L(11,"div",16)(12,"ul",17,0),ce(14,Ds,3,2,"li",18),Ht(15,"slice"),D(),L(16,"button",19,1),te("click",function(o){return X(i),ee(t.toggleOffcanvas(o,"more"))}),B(18,"More"),D()(),L(19,"div",20)(20,"a",21),K(21,"img",14),L(22,"span",15),B(23,"Prayatna"),D()()(),L(24,"div",9),ce(25,Os,7,2,"ng-container",22)(26,Us,2,0,"ng-template",null,2,Ft),D()()()(),L(28,"div",23,3),ce(30,Hs,3,1,"a",24),D(),L(31,"div",25)(32,"div",26)(33,"h5",27),B(34,"Menu"),D(),K(35,"button",28),D(),L(36,"div",29,4)(38,"ul",30),ce(39,Rs,3,2,"li",18),D()()()}if(e&2){let i=Ot(27);j(14),W("ngForOf",Rt(15,7,t.links,0,t.visibleCount)),j(2),Ut("d-none",t.visibleCount>=t.links.length),j(9),W("ngIf",t.isLoggedIn)("ngIfElse",i),j(5),W("ngForOf",t.links),j(9),W("ngForOf",t.offcanvasLinks)}},dependencies:[Wt,Te,Mt,Vt,$t],styles:["[_nghost-%COMP%]{display:block}.navbar[_ngcontent-%COMP%]   .app-logo[_ngcontent-%COMP%]{height:28px;width:auto}.profile-icon[_ngcontent-%COMP%]{height:36px;width:36px;object-fit:cover;border:2px solid rgba(0,0,0,.04)}.navbar[_ngcontent-%COMP%]   .container-fluid[_ngcontent-%COMP%] > .d-flex[_ngcontent-%COMP%]{gap:.5rem}#centerNav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.nav-more[_ngcontent-%COMP%]{white-space:nowrap}@media(max-width:576px){.navbar[_ngcontent-%COMP%]   .app-logo[_ngcontent-%COMP%]{height:24px}.profile-icon[_ngcontent-%COMP%]{height:32px;width:32px}}"]})};var Ue=class s{title=Et("prayatna");static \u0275fac=function(e){return new(e||s)};static \u0275cmp=ye({type:s,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"app-main"]],template:function(e,t){e&1&&(K(0,"app-header"),L(1,"main",0),K(2,"router-outlet"),D())},dependencies:[zt,Oe],encapsulation:2})};Bt(Ue,ss).catch(s=>console.error(s));
