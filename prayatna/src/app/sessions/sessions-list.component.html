      <div class="alert alert-danger alert-dismissible fade show" *ngIf="errorMessage">
        <strong>Error:</strong> {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = null"></button>
      </div>

<div class="sessions-page container py-3 mt-4" [style.position]="isLoading ? 'relative' : 'static'">
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loader-overlay">
    <div class="spinner-container">
      <div class="spinner-border" role="status" style="color: #0b4bb4;">
        <span class="visually-hidden">Loading sessions...</span>
      </div>
      <p class="text-muted mt-2" style="font-size: 0.95rem;">Loading sessions...</p>
    </div>
  </div>
  <div class="d-flex mb-3 align-items-center gap-3 actions-bar">
    <div class="flex-grow-1 search-holder">
      <div class="search-full">
        <span class="search-icon material-icons">search</span>
        <input class="form-control" placeholder="Search Sessions" [(ngModel)]="searchTerm" aria-label="Search" />
      </div>
    </div>

    <button class="btn btn-primary d-flex align-items-center justify-content-center add-btn" style="width: 46px; height: 46px;" (click)="createNew()" title="Add session">
      <span class="material-icons">add</span>
    </button>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="row g-3">
        <div *ngFor="let s of filteredSessions; let i = index" class="col-6 col-md-4">
          <div class="session-card">
            <div class="card-inner" (click)="view(i)" style="cursor:pointer">
              <div class="d-flex justify-content-between align-items-start">
                <div class="d-flex align-items-center gap-2 session-title-wrap">
                  <div class="session-title-block">
                    <div class="session-title-main">{{ s.sessionName }}</div>
                    <div *ngIf="s.isPredefined" class="session-title-suffix">System Generated</div>
                  </div>
                </div>
                <button class="icon-btn" title="Play" (click)="play(i); $event.stopPropagation();">
                  <span class="material-icons">play_arrow</span>
                </button>
              </div>
              <div class="duration subtle-text d-flex align-items-center gap-1">
                <span class="material-icons text-timer" style="font-size: 18px;">timer</span>
                <span class="duration-text">{{ s.totalDuration && s.totalDuration>0 ? durationToHuman(s.totalDuration) : 'Untimed' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!sessions.length" class="col-12 text-muted">No sessions yet. Use the + button to add one.</div>
      </div>
    </div>
  </div>
</div>
<!-- Delete Session Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
  <div class="modal-card small" (click)="$event.stopPropagation()">
    <h5>Confirm Delete</h5>
    <ng-container *ngIf="!deleteBlocked; else predefinedBlockedMsg">
      <p>Are you sure you want to delete this session? This action cannot be undone.</p>
    </ng-container>
    <ng-template #predefinedBlockedMsg>
      <p class="mb-0 text-danger fw-semibold">This session is synced or system-generated. Sign in to manage it.</p>
    </ng-template>
    <div class="d-flex gap-2 justify-content-end mt-3">
      <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
      <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleteBlocked" [class.disabled]="deleteBlocked">Delete</button>
    </div>
  </div>
</div>

<!-- Local Storage Warning Modal -->
<div class="modal-overlay" *ngIf="showLocalStorageWarning" (click)="dismissLocalStorageWarning()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    <h5>Local Storage Notice</h5>
    <p>You are not logged in. Your sessions are stored on this device only and may be lost if browser cache or memory is cleared.</p>
    <p class="mb-0">To save your sessions to your profile and access them from any device, please sign in.</p>
    <div class="d-flex gap-2 justify-content-end mt-3">
      <button type="button" class="btn btn-secondary" (click)="dismissLocalStorageWarning()">Continue as Guest</button>
      <button type="button" class="btn btn-primary" (click)="goToLogin()">Sign In</button>
    </div>
  </div>
</div>
