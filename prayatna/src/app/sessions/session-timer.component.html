<div class="session-timer-page container mt-2 pb-3">
  <!-- Session Timer Card -->
  <div class="timer-card session-timer-card mb-3" [class.session-only]="!session || session.tasks.length === 0">
    <div class="timer-header d-flex justify-content-between align-items-center mb-2" [class.mb-4]="!session || session.tasks.length === 0">
      <button 
        class="btn btn-link p-0 text-primary" 
        (click)="togglePlayPause()">
        <span class="material-icons" [style.font-size]="(!session || session.tasks.length === 0) ? '48px' : '36px'">{{ isRunning ? 'pause' : 'play_arrow' }}</span>
      </button>
      <span class="timer-title flex-grow-1 text-center" [style.font-size]="(!session || session.tasks.length === 0) ? '1.8rem' : '1.5rem'">Session Timer</span>
      <button class="btn btn-link p-0" (click)="isRunning ? stopTimer() : null" [class.opacity-50]="!isRunning">
        <span class="material-icons text-danger" [style.font-size]="(!session || session.tasks.length === 0) ? '44px' : '32px'">stop</span>
      </button>
    </div>
    <div class="timer-display session-timer-display" [class.timer-negative]="isSessionTimerNegative()" [class.session-only-timer]="!session || session.tasks.length === 0">
      {{ formatTime(sessionElapsedSeconds) }}
    </div>
  </div>

  <!-- Task Selection Card -->
  <div *ngIf="session && session.tasks && session.tasks.length > 0" class="timer-card task-selection-card mb-3">
    <div class="task-selection-title mb-4">Current Task: {{ getSelectedTaskName() }}</div>
    
    <!-- Task Duration Info (always show when task is selected) -->
    <div class="timer-display task-timer-display mb-3 mt-3" [class.timer-negative]="isTaskTimerNegative()">
      {{ formatTime(taskElapsedSeconds) }}
    </div>
    
    <!-- Subtask Info Section (always show when task has subtasks) -->
    <div *ngIf="selectedTaskIndex !== null && session && session.tasks[selectedTaskIndex] && session.tasks[selectedTaskIndex].hasSubtasks && session.tasks[selectedTaskIndex].subtasks && session.tasks[selectedTaskIndex].subtasks!.length > 0" class="subtask-info">
      <div class="subtask-row">
        <div class="subtask-column">
          <div class="subtask-label">Current Subtask</div>
          <div class="subtask-name">{{ currentSubtaskIndex < session!.tasks[selectedTaskIndex!].subtasks!.length ? session!.tasks[selectedTaskIndex!].subtasks![currentSubtaskIndex].subtaskName : 'Completed' }}</div>
        </div>
        <div class="subtask-column">
          <div class="subtask-label">Next Subtask</div>
          <div class="subtask-name">{{ currentSubtaskIndex + 1 < session!.tasks[selectedTaskIndex!].subtasks!.length ? session!.tasks[selectedTaskIndex!].subtasks![currentSubtaskIndex + 1].subtaskName : '-' }}</div>
        </div>
      </div>
      <div class="timer-display subtask-timer-display">
        {{ formatTime(subtaskElapsedSeconds) }}
      </div>
    </div>
  </div>

  <!-- Instruction Text -->
  <p *ngIf="session && session.tasks && session.tasks.length > 0" class="text-center text-muted mb-2">Select to start or switch between tasks</p>

  <!-- Task List -->
  <div class="row g-2" *ngIf="session && session.tasks && session.tasks.length > 0">
    <div class="col-6" *ngFor="let task of session.tasks; let i = index">
      <div 
        class="task-select-card" 
        [class.selected]="selectedTaskIndex === i"
        (click)="selectTask(i)">
        <div class="task-name">{{ task.taskName }}</div>
        <div class="task-duration-display">{{ formatDuration(getTaskDuration(task)) }}</div>
      </div>
    </div>
  </div>

  <!-- No Tasks Message -->
  <div *ngIf="!session || session.tasks.length === 0" class="text-center text-muted py-5">
    <p class="mb-0">No tasks in this session. Use the session timer above to track your time.</p>
  </div>

  <!-- Task Selection Required Modal -->
  <div class="modal fade" [class.show]="showTaskSelectionModal" [style.display]="showTaskSelectionModal ? 'block' : 'none'" tabindex="-1" *ngIf="showTaskSelectionModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">Task Selection Required</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <p class="mb-0">Please select a task from the list below to start the session timer.</p>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-primary" (click)="closeModal()">OK</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade" [class.show]="showTaskSelectionModal" *ngIf="showTaskSelectionModal" (click)="closeModal()"></div>
</div>
